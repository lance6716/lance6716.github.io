---
layout: post
title:  "Specifying Systems 第二章笔记"
tags: tech
---

# 2.1 动作

通过描述变量在离散时间下的状态状态转移描述计算机系统。

# 2.2 一个时钟

相邻状态的一次转移叫做*步*，通过描述*步*我们可以描述所有合法状态是如何转换的。在一对新旧状态中，通过`'`表示新状态的变量，例如
```
hr' = IF hr /= 12 THEN hr + 1 ELSE 1
```
这种包含`'`的公式叫做*动作*。*动作*是公式，因此具有布尔值的含义，一些状态转移（*步*）使得*动作*的值为真，这类似于*运行*了一些*步*。

再加上系统的初始状态公式，我们就可以完整描述系统了。初始状态仅判定一个时刻，即系统初始时刻，而*动作*判定系统的每次状态转移，即有限或无限个时刻，我们使用`[]formula`表示这种发生多次的判定。

某些状态转移可能仅有无关变量的改变，*动作*描述的变量都保持不变，这在语义上是合法的状态转移，但却使*动作*判定为假，因此我们使用`[][formula]_variable`表示允许某些变量保持不变。该语法实际上表示`[]formula \/ (variable' = variable)`。

初始状态公式和状态转移公式（*步*）即为系统的规范。

# 2.3 向规范更进一步

规范是时序公式，一些系统使得公式为真，我们可以说这些系统满足规范。那么是否所有满足规范的系统都满足一些性质呢？将这种叙述通过蕴含运算符表述为如下公式
```
specification => some_property
```
如果上公式为真，我们可以得到满足规范的系统总是满足这些性质。我们把上公式叫做*定理*。TLA 可以帮助我们判断*定理*的真假。

# 2.4 TLA+ 中的规范

```
---------------------- MODULE HourClock ----------------------
EXTENDS Naturals
VARIABLE hr
HCini == hr \in (1 .. 12)
HCnxt == hr' = IF hr # 12 THEN hr + 1 ELSE 1
HC == HCini /\ [][HCnxt]_hr
--------------------------------------------------------------
THEOREM HC => []HCini
==============================================================
```

上面的 TLA+ 程序是 2.1~2.3 节时钟的规范。

第一行：一个 TLA+ 规范由模块组成。

第二行：`EXTENDS`关键字导入其他模块。`Naturals`模块包含自然数以及相关运算符。

第三行：`VARIABLE`关键字定义变量。

第四至六行：`==`运算符定义公式，其他运算符的含义基本为象形或者英文表达的含义。

第七行：分隔线可以出现在任意位置，分割线的长度需要大于 4。

第八行：`THEOREM`关键词表示*定理*。

第九行：表示模块的结束。

# 2.5 另一个规范

规范可以有多种表示形式，例如将 2.4 中的`HCnxt`和`HC`分别替换为
```
HCnxt2 == hr' = (hr % 12) + 1
HC2 == HCini /\ [][HCnxt2]_hr
``` 
可以验证`HC`与`HC2`等价。但要注意`HCnxt`与`HCnxt2`并不等价，因为`hr`从 24 到 1 的状态转移仅使后者为真。
